<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Graphic line</title>  	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/x-icon" href="./img/biticon.ico" media="screen" />

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
	<link href="css/elegant-icons.css" rel="stylesheet" type="text/css">
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/ticket.js"></script>
	<link rel="stylesheet" type="text/css" href="css/base.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<!-- vue part -->
	<link rel="stylesheet" href="static/style.css">
    <script src="static/dist/vue.js"></script>
	<script src="static/Constant.js"></script>

	<script src="https://code.highcharts.com/highcharts.js"></script>
	<!-- <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"> -->
	<link href="https://cdn.bootcss.com/bootstrap/4.1.1/css/bootstrap.css" rel="stylesheet">
    <script src="http://echarts.baidu.com/dist/echarts.min.js"></script>
	<script src="https://cdn.bootcss.com/axios/0.18.0/axios.min.js"></script>
</head>
<body>
	<header id="top">
		<ul class="nim">
			<li>
				<a href="javascript:history.go(-1)">
					<i class="fa fa-chevron-left fa-lg left"></i>
				</a>
			</li>
			<li><span>价格走势</span></li>
			<li><i onclick="replaceDoc()" class="fa fa-repeat fa-lg right"></i></li>
		</ul>
	</header>
    <article>
        <div>
			<div class="a">
				<table class="sigerd"></table>
			</div>
			<!-- Match information -->
			<!-- Vue: demo root element -->
			<div id="information">
				<div class="col-12" align="center">
					<input v-model="matchCode"  readonly="readonly"></input>
					<input v-model="homeTeam"  readonly="readonly"></input>
					<input v-model="awayTeam"  readonly="readonly"></input>
				</div>
				<div>
					<div class="col-12" align="center"> 
						<!-- <span> 胜平负 </span><br /> -->
						<button id = "1" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 胜 {{homeOdds}} </button>
						<button id = "2" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 平 {{awayOdds}} </button>
						<button id = "3" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 负 {{drawOdds}} </button>
					</div>
					<div class="col-12" align="center">
						<!-- <span> 让球胜平负 </span> -->
						<button id = "4" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 胜[{{hhadLine}}] {{fOdds}} </button>
						<button id = "5" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 平[{{hhadLine}}] {{gOdds}} </button>
						<button id = "6" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 负[{{0-hhadLine}}] {{tOdds}} </button>
					</div>
					<!-- <br /> -->
				</div>
			</div>
			<div class="jia">
				<b>最高价格：<i>1000</i></b>
				<b>当前价格：<i>1000</i></b>
			</div>
			<!-- Chart -->
			<div class="echarts">
				<div class="echartsdiv" style="width: 100%;border: 1px solid #ddd;">
					<div id="main" style="width: 100%; height:250px;"></div>
				</div>
			</div>
			<div class="bg">
				<h4>购买后查看</h4>
				<p class="ppp"><a href="javascript:history.go(-1)">去购买</a></p>
			</div>
			<!-- Notes -->
			<p class="explain">
				<span>价格走势：按照投注本金为1000元，为这注彩票方案提供实时的报价。</span><br>
				<b class="last">以上数据由<i>彩易科思</i>提供</b>
			</p>
		</div>
	</article>
	<!-- vue: component template -->
	<script type="text/x-template" id="grid-template"></script>
	<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
    <script src="static/grid.js"></script>
</body>	

<script type="text/javascript">
localStorage.removeItem("zimu")
	// ----== variables ==----
	$(".bg").hide();

	// data: init variables
	var chartData
	var Xtimes    //实际用来盛放X轴坐标值
	var shuju
	var count

	var zi
	// TODO: to use vue variables to replace the following vars parsed by jquery.
	// http://localhost:4200/assets/reckoner/ticket.html?matchCode=1005&homeTeam=%E5%BE%B7%E5%9B%BD&awayTeam=%E5%B7%B4%E8%A5%BF&H=2.1&A=0.7&X=0.5&rang=-1&F=2.1&G=3.6&T=1.5&M=2
	var matchCode = UrlParam.paramValues("matchCode");
	var homeTeam = UrlParam.paramValues("homeTeam");
	var awayTeam = UrlParam.paramValues("awayTeam");
	var homeOdds = UrlParam.paramValues("H");
	var awayOdds = UrlParam.paramValues("A");
	var drawOdds = UrlParam.paramValues("X");
	var hhadLine = UrlParam.paramValues("rang");
	var fOdds = UrlParam.paramValues("F");
	var gOdds = UrlParam.paramValues("G");
	var tOdds = UrlParam.paramValues("T");
	var mOpt = UrlParam.paramValues("M");
	var uniCode = UrlParam.paramValues("uniCode");
	var pool = UrlParam.paramValues("pool");

	if(mOpt==1 ||mOpt==4){
		this.zi="1";
	}else if(mOpt==2 ||mOpt==5){
		this.zi="2";
	}else{
		this.zi="3";
	}

var play=pool;

	var tkId = matchCode + '-' + homeTeam + '-' + awayTeam
	console.log(matchCode, homeTeam, awayTeam,uniCode,pool,'/*/*/*');

	// ----== setters ==----
	
	// setter: chartData
	var setChartData = function(chartdata){
		this.chartData = chartdata;
		// chart(this.chartData)
	}

	// setter: tkId
	var setTkId = function(tkid){
		this.tkId = tkid;
	}
	
	// function: chart deco
	var chart = function(data) {
		Xtimes = [];    //实际用来盛放X轴坐标值
		shuju = [];
		count = 0;
		countt =0;
		// maxprice = data.maxPrice;
		successdata = data.oddsHistory;
		// successdata = JSON.parse(successdata);
		if (successdata) {
			count =successdata.length;
			price = 1000;
			successdata[0].timestamp="出票";
			successdata[count-1].timestamp="当前";
			shuju.push(price)
			// Xtimes.push(timestamp)
			if(count>1){
				for (var i = 0; i < count; i++) {
					Xtimes.push(successdata[i].timestamp);
					shuju.push(successdata[i].price);
					console.log(i,"bbbbb",i+1);
					// if(i+1==count){
					// 	console.log("hhhh")
					// 	//Xtimes.push(successdata[i+1].timestamp);
					// shuju.push(price);
					// }
				}
			}else{
				var timestamp = "出票";
				Xtimes.push(timestamp);
				Xtimes.push(successdata[0].timestamp);
				shuju.push(successdata[0].price);
			}
			console.log(shuju,"aaaa");
		}
		$(".tbottom").empty();
		// $('#main').before('<div class\="tbottom\">'+'<h4>'+'最高价格：'+'<i>' + data.maxPrice + '</i>'+'</h4>'+'</div >');
	}

	// function: get chart data
    var funcGetChart = function (tkId) {
		console.log(uniCode,play,zi,"8*8*");
		$.ajax({
			async : false,
			type : "GET",
			url : 'http://192.168.1.5:12320/caiexlive/calculator/getLotteryGraphic?matchCode=' +uniCode+ '&pool=' +play+ '&option=' + zi,
			// url: 'https://private-200ab-zhanglimu.apiary-mock.com/caiexlive/calculator/getLotteryGraphic?matchCode=' +uniCode+ '&pool=' +play+ '&option=' + zi,
			dataType : "json",
			success : function(response) {
				setChartData(response);
				console.log(response)
			}
		});
	}

	// 不再使用, 而是用 vue 替代了这部分 jquery 的拼接 html 的方法
			// function: display information
			var information = function(dataObj, callback){
				console.log(dataObj,"1");
				if(callback && callback instanceof Function){
					//callback();
				
					if(dataObj.pay==0){
						$(".echarts").hide();
						$(".bg").show();
					}else{
						$(".echarts").show();
						$(".bg").hide();
					}
					
					var html="";
					$('.sigerd').empty();
					for (var i = 0; i < dataObj.Match.length; i++) {
						html +='<tbody><tr class="lists">';
						html +='<td>'+dataObj.Match[i].homeName+'</td>';
						html +='<td>VS</td>';
						html +='<td>'+dataObj.Match[i].awayName+'</td></tr>';

						// dataObj.Match[i].play==0?	html +='<tr class\="she\"><td><button style="background:#fe3c3c;color:#fff;">胜</button></td>'
						// :	html +='<tr class\="she\"><td><button>胜</button></td>';
						// dataObj.Match[i].play==1?	html +='<td>'+'<button style="background:#fe3c3c;color:#fff;">'+'平'+'</button>'+'</td>'
						// :	html +='<td>'+'<button>'+'平'+'</button>'+'</td>';
						// dataObj.Match[i].play==2?html +='<td class="td'+i+'"><button style="background:#fe3c3c;color:#fff;">负</button></td>'
						// :	html +='<td class="td'+i+'"><button>负</button></td>';
						// // dataObj[i].achievement==0?html+='<td><b class\="hong\">赢</b></td>'
						// // :	html+='<td><b class\="lan\">负</b></td></tr>';
						
						html +='</tbody>';
					}
					$('.sigerd').append(html);
					// if(dataObj.achievement==0){
					// 	$(".td0").after('<td><b class\="hong\">赢</b></td>')
					// }else if(dataObj.achievement==1){
					// 	$(".td0").after('<td><b class\="lan\">输</b></td>')
					// }
				}
			}
	// function: display information
	var displayOptions = function(dataObj, callback){
		console.log(dataObj,"1");
		if(callback && callback instanceof Function){
			//callback();
		
			if(dataObj.pay==0){
				$(".echarts").hide();
				$(".bg").show();
			}else{
				$(".echarts").show();
				$(".bg").hide();
			}
			
			var html="";
			$('.sigerd').empty();
			for (var i = 0; i < dataObj.Match.length; i++) {
				html +='<tbody><tr class="lists">';
				html +='<td>'+dataObj.Match[i].homeName+'</td>';
				html +='<td>VS</td>';
				html +='<td>'+dataObj.Match[i].awayName+'</td></tr>';

				dataObj.Match[i].play==0?	html +='<tr class\="she\"><td><button style="background:#fe3c3c;color:#fff;">胜</button></td>'
				:	html +='<tr class\="she\"><td><button>胜</button></td>';
				dataObj.Match[i].play==1?	html +='<td>'+'<button style="background:#fe3c3c;color:#fff;">'+'平'+'</button>'+'</td>'
				:	html +='<td>'+'<button>'+'平'+'</button>'+'</td>';
				dataObj.Match[i].play==2?html +='<td class="td'+i+'"><button style="background:#fe3c3c;color:#fff;">负</button></td>'
				:	html +='<td class="td'+i+'"><button>负</button></td>';
				// dataObj[i].achievement==0?html+='<td><b class\="hong\">赢</b></td>'
				// :	html+='<td><b class\="lan\">负</b></td></tr>';
				html +='</tr></tbody>';
			}
			$('.sigerd').append(html);
			if(dataObj.achievement==0){
				$(".td0").after('<td><b class\="hong\">赢</b></td>')
			}else if(dataObj.achievement==1){
				$(".td0").after('<td><b class\="lan\">输</b></td>')
			}
		}
	}

	// function: echart.js
	function echart(){
		// var XData=["出票", "当前"];
		// var shu=["1","2"]

		var myChart = echarts.init(document.getElementById('main'));
		var option = {
			tooltip: {
				show:true,
			},
			title: {
			// text: '平',
				textStyle: {
					fontSize: 14,
					fontWeight: 'bolder',
				},
			}, 
			grid:{
				borderWidth:0,  //去掉外围线
				x:20,
				y:30,
				x2:20,
				y2:30,
			},
			xAxis: [{
				splitLine: {show: false}, //去除网格线
				axisTick: {show: false}, //去掉刻度
				type: 'category',
				boundaryGap: false,
				data: Xtimes,
				axisLine:{
					lineStyle:{
						color:'#959595',
						width:1,
					}
				},
				axisLabel: {
					interval:count-2,
					// rotate : 40, 
				},
			}],
			yAxis: [{
				splitLine: {show: false},
				axisTick: {show: false},
				type: 'value',
				axisLabel: {
					show: false,  //刻度值
				},
				axisLine:{
					lineStyle:{
						color:'#959595',
						width:1,
					}
				},
			}],
			series: [{
				type: 'line',
				data: shuju,
				symbol:'none',  //去掉圆点
				itemStyle: {
					normal: {
						areaStyle: {type: 'default'},
						lineStyle:{  
							color:'#fe3c3c',
							width:1.5
						},
					}
				},
			}]
		};
		
		myChart.setOption(option, true);

	}

	// function: refresh chart
	
	var funcRefresh = function(tkId) {
		console.log(this.zi,"*9*9*");
		let zi = localStorage.getItem("zimu");
		funcGetChart(tkId) // 1) ajax GET, 2) set the chart data 
		chart(this.chartData) // 3) chart
		// information(json, function(){})
		echart()
	}

	// ----== buttons/actions ==----

	// button: refresh url
	function replaceDoc(){
		window.location.reload()
	}

	// -- -- button: click on other options
	var btnClickOnOption = function(thisButton) {		
// let zimu="";
		let tempId = '4001HAD1'
		setTkId(tempId)
if(thisButton.id==1 ||thisButton.id==4){
	this.zi="1";

}else if(thisButton.id==2 ||thisButton.id==5){
	this.zi="2";
}else{
	this.zi="3";
}
if(thisButton.id==1 ||thisButton.id==2 ||thisButton.id==3){
	this.play="HAD";
}else{
	this.play="HHAD";
}
		if(thisButton.className == 'btn btn-default'){  
			thisButton.className = 'btn btn-danger';  
			var name = thisButton.id;  
			var btn = document.getElementById('information').getElementsByClassName('btn btn-danger');  
			for(var j=0;j<btn.length;j++){  
				if(btn[j].id!=name){  
					btn[j].className = 'btn btn-default';
				}  
			}     
		}
	}

	// action: auto refresh chart
	funcRefresh()
	setInterval(funcRefresh, 15000);

</script>

</html>