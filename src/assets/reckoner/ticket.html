<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>彩ex</title>  	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/x-icon" href="./img/biticon.ico" media="screen" />

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
	<link href="css/elegant-icons.css" rel="stylesheet" type="text/css">
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/ticket.js"></script>
	<link rel="stylesheet" type="text/css" href="css/base.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<!-- vue part -->
	<link rel="stylesheet" href="static/style.css">
    <script src="static/dist/vue.js"></script>
	<script src="static/Constant.js"></script>

	<script src="https://code.highcharts.com/highcharts.js"></script>
	<!-- <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"> -->
	<link href="https://cdn.bootcss.com/bootstrap/4.1.1/css/bootstrap.css" rel="stylesheet">
    <script src="http://echarts.baidu.com/dist/echarts.min.js"></script>
	<script src="https://cdn.bootcss.com/axios/0.18.0/axios.min.js"></script>
</head>
<body>
	<header id="top">
		<ul class="nim">
			<li>
				<a href="javascript:history.go(-1)">
					<i class="fa fa-chevron-left fa-lg left"></i>
				</a>
			</li>
			<li><span>价格走势</span></li>
			<li><i onclick="replaceDoc()" class="fa fa-repeat fa-lg right"></i></li>
		</ul>
	</header>
    <article>
        <div>
			<div class="a">
				<table class="sigerd"></table>
			</div>
			<!-- Match information -->
			<!-- Vue: demo root element -->
			<div id="information">
				<div class="col-12" align="center">
					<input v-model="homeTeam"  readonly="readonly"></input>
					<input  readonly="readonly"></input>
					<input v-model="awayTeam"  readonly="readonly"></input>
				</div>
				<div>
					<div class="col-12" align="center"> 
						<button id = "1" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 胜 {{homeOdds}} </button>
						<button id = "2" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 平 {{drawOdds}} </button>
						<button id = "3" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 负 {{awayOdds}} </button>
					</div>
					<div class="col-12" align="center">
						<button id = "4" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 胜[{{hhadLine}}] {{fOdds}} </button>
						<button id = "5" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 平[{{hhadLine}}] {{tOdds}} </button>
						<button id = "6" type = "button" class = "btn btn-default" onclick = "btnClickOnOption(this)"> 负[{{0-hhadLine}}] {{gOdds}} </button>
					</div>
					<!-- <br /> -->
				</div>
			</div>
			<!-- <div class="jia">
				<b>最高价格：<i>9999</i></b>
				<b>当前价格：<i>1000</i></b>
			</div> -->
			<!-- Chart -->
			<div class="echarts">
				<div class="echartsdiv" style="width: 100%;border: 1px solid #ddd;">
					<div id="main" style="width: 100%; height:250px;"></div>
				</div>
			</div>
			<p class="explain">
				<span>价格走势：每个彩票方案出票金额为1000元，彩易科思为该彩票方案提供从竞彩开售到比赛结束的实时报价</span><br>
				<b class="last">以上数据由<i>彩易科思</i>提供</b>
			</p>
		</div>
	</article>
	<!-- vue: component template -->
	<script type="text/x-template" id="grid-template"></script>
	<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
    <script src="static/grid.js"></script>
</body>	

<script type="text/javascript">
localStorage.removeItem("zimu")
	// data: init variables
	var chartData
	var Xtimes    //实际用来盛放X轴坐标值
	var shuju
	var count
	var zi
	// TODO: to use vue variables to replace the following vars parsed by jquery.
	var matchCode = UrlParam.paramValues("matchCode");
	var homeTeam = UrlParam.paramValues("homeTeam");
	var awayTeam = UrlParam.paramValues("awayTeam");
	var homeOdds = UrlParam.paramValues("H");
	var awayOdds = UrlParam.paramValues("A");
	var drawOdds = UrlParam.paramValues("X");
	var hhadLine = UrlParam.paramValues("rang");
	var fOdds = UrlParam.paramValues("F");
	var gOdds = UrlParam.paramValues("G");
	var tOdds = UrlParam.paramValues("T");
	var mOpt = UrlParam.paramValues("M");
	var uniCode = UrlParam.paramValues("uniCode");
	var pool = UrlParam.paramValues("pool");

if(mOpt==1){
	this.zi="1";
}else if(mOpt==2){
	this.zi="X";
}else if(mOpt==3){
	this.zi="2";
}else if(mOpt==4){
	this.zi="1"+"["+hhadLine+"]";
}else if(mOpt==5){
	this.zi="X"+"["+hhadLine+"]";
}else{
	sixhhadLine = hhadLine>0 ? "-"+hhadLine : Math.abs(hhadLine)
	this.zi="2"+"["+sixhhadLine+"]";
}

var play=pool;
	var tkId = matchCode + '-' + homeTeam + '-' + awayTeam
	// console.log(matchCode, homeTeam, awayTeam,uniCode,pool,'/*/*/*');
	// ----== setters ==----
	// setter: chartData
	var setChartData = function(chartdata){
		this.chartData = chartdata;
		if(this.chartData !="暂无数据"){
			chart(this.chartData) // 3) chart
			echart()
			$(".haha").empty();
		}else{
			$(".jia").empty();
			$(".haha").empty();
			$('#main').before('<div class\="haha\">'+'<b>暂无数据</b>'+'</div >');
			chart(this.chartData)
			echart()
		}
		// chart(this.chartData)
	}
	// setter: tkId
	var setTkId = function(tkid){
		this.tkId = tkid;
	}
	// function: chart deco
	var chart = function(data) {
		Xtimes = [];    //实际用来盛放X轴坐标值
		shuju = [];
		count = 0;
		// if(data!=null&&data.maxPrice!=null){
		// 	maxPrice = data.maxPrice;
		// }else{
		// 	maxPrice ="0";
		// }
		
		// if(data!=null&&data.currentPrice!=undefined){
		// 	currentPrice = data.currentPrice;
		// }else{
		// 	currentPrice = "0";
		// }
		maxPrice = data.maxPrice; //!=null ? data.maxPrice : 0;
		currentPrice = data.currnetPrice; //!=null ? data.currentPrice : 0;
			successdata = data.oddsHistory;
		if (successdata) {
			count =successdata.length;
			price = 1000;
			shuju.push(price)
			if(count>1){
				var timestamp = "出票";
				Xtimes.push(timestamp);
				for (var i = 0; i < count; i++) {
					Xtimes.push(successdata[i].timestamp);
					shuju.push(successdata[i].price);
				}
			}else{
				var timestamp = "出票";
				Xtimes.push(timestamp);
				Xtimes.push(successdata[0].timestamp);
				shuju.push(successdata[0].price);
			}
			Xtimes[Xtimes.length-1]="当前"	
		}
		if(this.chartData !="暂无数据"){
		$(".jia").empty();
		$('#information').after('<div class\="jia\">'+'<b>'+'最高价格：'+'<i>' + maxPrice + '</i>'+'</b>'+'<b>'+'当前价格：'+'<i>' + currentPrice + '</i>'+'</b>'+'</div >');
		}
	}

	// function: get chart data
    var funcGetChart = function (tkId) {
		// console.log(uniCode,play,zi,"8*8*");
		$.ajax({
			async : false,
			type : "GET",
			//生产
			// url : 'http://live-service.caiex.com:12320/caiexlive/calculator/getLotteryGraphic?matchCode=' +uniCode+ '&pool=' +play+ '&option=' + zi,
			//1.5
			// url : 'http://192.168.1.5:12320/caiexlive/calculator/getLotteryGraphic?matchCode=' +uniCode+ '&pool=' +play+ '&option=' + zi,
			//云测试
			url : 'http://caiex-live.jingcai.trade:12320/caiexlive/calculator/getLotteryGraphic?matchCode=' +uniCode+ '&pool=' +play+ '&option=' + zi,
			
			// url: 'https://private-200ab-zhanglimu.apiary-mock.com/caiexlive/calculator/getLotteryGraphic?matchCode=' +uniCode+ '&pool=' +play+ '&option=' + zi,
			dataType : "json",
			success : function(response) {
				setChartData(response);
			}
			,
			error:function(error){
				setChartData("暂无数据");
			}
		});
	}
	// function: echart.js
	function echart(){
		// var XData=["出票", "当前"];
		// var shu=["1","2"]

		var myChart = echarts.init(document.getElementById('main'));
		var option = {
			tooltip: {
				show:true,
			},
			title: {
			// text: '平',
				textStyle: {
					fontSize: 14,
					fontWeight: 'bolder',
				},
			}, 
			grid:{
				borderWidth:0,  //去掉外围线
				x:20,
				y:30,
				x2:20,
				y2:30,
			},
			xAxis: [{
				splitLine: {show: false}, //去除网格线
				axisTick: {show: false}, //去掉刻度
				type: 'category',
				boundaryGap: false,
				data: Xtimes,
				axisLine:{
					lineStyle:{
						color:'#959595',
						width:1,
					}
				},
				axisLabel: {
					interval:count-1,
					// rotate : 40, 
				},
			}],
			yAxis: [{
				splitLine: {show: false},
				axisTick: {show: false},
				type: 'value',
				axisLabel: {
					show: false,  //刻度值
				},
				axisLine:{
					lineStyle:{
						color:'#959595',
						width:1,
					}
				},
			}],
			series: [{
				type: 'line',
				data: shuju,
				symbol:'none',  //去掉圆点
				itemStyle: {
					normal: {
						areaStyle: {
							type: 'default',
							// opacity:0.1,
						},
						lineStyle:{  
							color:'#fe3c3c',
							width:1.5,
						},
					}
				},
			}]
		};
		
		myChart.setOption(option, true);
	}

	// function: refresh chart
	var funcRefresh = function(tkId) {
		console.log("+++++");
		funcGetChart(tkId) // 1) ajax GET, 2) set the chart data 
	}
	// ----== buttons/actions ==----
	function replaceDoc(){
		funcRefresh();
	}
	// -- -- button: click on other options
	var btnClickOnOption = function(thisButton) {	
// let zimu="";
		let tempId = '4001HAD1'
		setTkId(tempId)
if(thisButton.id==1){
	this.zi="1";
}else if(thisButton.id==2){
	this.zi="X";
}else if(thisButton.id==3){
	this.zi="2";
}else if(thisButton.id==4){
	this.zi="1"+"["+hhadLine+"]";
}else if(thisButton.id==5){
	this.zi="X"+"["+hhadLine+"]";
}else{
	sixhhadLine = hhadLine>0 ? "-"+hhadLine : Math.abs(hhadLine)
	this.zi="2"+"["+sixhhadLine+"]";
}
if(thisButton.id==1 ||thisButton.id==2 ||thisButton.id==3){
	this.play="HAD";
}else{
	this.play="HHAD";
}
		if(thisButton.className == 'btn btn-default'){  
			thisButton.className = 'btn btn-danger';  
			var name = thisButton.id;  
			var btn = document.getElementById('information').getElementsByClassName('btn btn-danger');  
			for(var j=0;j<btn.length;j++){  
				if(btn[j].id!=name){  
					btn[j].className = 'btn btn-default';
				}  
			}     
		}
		// funcRefresh()
		funcGetChart(tkId)
	}

	// action: auto refresh chart
	funcRefresh()
	setInterval(funcRefresh, 15000);

</script>

</html>